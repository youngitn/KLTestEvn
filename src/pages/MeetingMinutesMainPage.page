<apex:page doctype="html-5.0" extensions="MeetingMinutesMainPageController" showheader="true" sidebar="true" standardcontroller="KL_Systems__c">
    <html>
        <link href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet"/>
        <link crossorigin="anonymous" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" rel="stylesheet"/>
        <link href="https://unpkg.com/purecss@1.0.0/build/base-min.css" rel="stylesheet"/>
        <link href="https://unpkg.com/purecss@1.0.0/build/grids-responsive-min.css" rel="stylesheet"/>
        <link href="{!URLFOR($Resource.JSbundle, '/app/RWD-Table.css')}" rel="stylesheet"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js">
        </script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js">
        </script>
        <script src="https://malsup.github.io/jquery.blockUI.js" type="text/javascript">
        </script>
        <script crossorigin="anonymous" src="{!URLFOR($Resource.JSbundle, '/app/MeetingMinutes/mainJS.js')}" />
        <script>
        	const recordTypeId = '{!recordTypeId}';
        </script>
        <div id="tabs">
            <ul>
                <li>
                    <a href="#tabs-1">
                        建立新會議紀錄
                    </a>
                </li>
                <li>
                    <a href="#tabs-2">
                        查詢已建立會議紀錄
                    </a>
                </li>
            </ul>
            <div id="tabs-2">
                <apex:include pagename="MeetingMinutesQueryPage">
                </apex:include>
            </div>
            <div id="tabs-1">
                <apex:sectionheader title="新會議記錄">
                </apex:sectionheader>
                <apex:pageblock>
                    <apex:form id="form" styleclass="pure-form pure-form-stacked">
                        <fieldset>
                            <legend>
                                會議基本資料
                            </legend>
                            <div class="pure-g">
                                <div class="pure-u-1 pure-u-md-1-3">
                                    <label for="Employee">
                                        會議日期
                                    </label>
                                    <apex:inputfield id="Meeting_Date__c" showdatepicker="false" styleclass="pure-u-1 pure-u-md-2-3" type="date" value="{!kls.Meeting_Date__c}">
                                    </apex:inputfield>
                                </div>
                                <div class="pure-u-1 pure-u-md-1-3">
                                    <label for="Employee">
                                        會議時間
                                    </label>
                                    <apex:inputfield styleclass="pure-u-1 pure-u-md-2-3" value="{!kls.Meeting_Time__c}">
                                    </apex:inputfield>
                                </div>
                                <div class="pure-u-1 pure-u-md-1-3">
                                </div>
                                <div class="pure-u-1 pure-u-md-1-3">
                                    <label for="Employee">
                                        會議主持人
                                    </label>
                                    <span id="lookupInput">
                                        <apex:inputfield id="Toastmaster" styleclass="pure-u-1 pure-u-md-2-3" value="{!kls.Toastmaster__c}">
                                        </apex:inputfield>
                                    </span>
                                </div>
                                <div class="pure-u-1 pure-u-md-1-3">
                                    <label for="Employee">
                                        會議記錄人
                                    </label>
                                    <span id="lookupInput2">
                                        <apex:inputfield id="Note_Taker__c" styleclass="pure-u-1 pure-u-md-2-3" value="{!kls.Note_Taker__c}">
                                        </apex:inputfield>
                                        <span class="lookupInput">
                                        </span>
                                    </span>
                                </div>
                                <div class="pure-u-1 pure-u-md-1-3">
                                </div>
                                <div class="pure-u-1 pure-u-md-1-3">
                                    <label for="Employee">
                                        會議地點
                                    </label>
                                    <apex:inputfield styleclass="pure-u-1 pure-u-md-2-3" value="{!kls.Meeting_Place__c}">
                                    </apex:inputfield>
                                </div>
                                <div class="pure-u-1 pure-u-md-3-3">
                                    <label for="Employee">
                                        會議主題
                                    </label>
                                    <apex:inputfield styleclass="pure-u-1 pure-u-md-1-2" value="{!kls.Meeting_Subject__c}">
                                    </apex:inputfield>
                                </div>
                            </div>
                            <c:approvalprocessbuttonswitcher cancelaction="{!cancelAction}" iseditable="{!isEditable}" saveaction="{!saveAction}" status="{!NowStatus}">
                            </c:approvalprocessbuttonswitcher>
                            <br/>
                            <br/>
                            <legend>
                                決議事項
                            </legend>
                            <apex:commandbutton action="{!addParticipant}" oncomplete="onCompleteJSFunc();" rerender="output1" status="retrieveStatus" styleclass="pure-button pure-button-primary pure-u-1 pure-u-xl-1-24 btn" value="新增">
                            </apex:commandbutton>
                            <br/>
                            <apex:outputpanel id="output1" layout="block" styleclass="scroll">
                                <apex:actionstatus id="retrieveStatus" starttext="(waiting...)">
                                </apex:actionstatus>
                                <table class="pure-table rwd-table" id="participantsTable">
                                    <thead>
                                        <th width="5%">
                                        </th>
                                        <th width="2%">
                                            序號
                                        </th>
                                        <th width="10%">
                                            工號
                                        </th>
                                        <th width="10%">
                                            姓名
                                        </th>
                                        <th>
                                            工作指派描述
                                        </th>
                                    </thead>
                                    <tbody>
                                        <!-- 定義 actionfunction 和其參數 param -->
                                        <!-- 可理解為js function ->   function delRowInJavascript(rowId){ } -->
                                        <apex:actionfunction action="{!deleteRow}" name="delRowInJavascript" rerender="output1" status="retrieveStatus">
                                            <apex:param name="rowId" value="">
                                            </apex:param>
                                        </apex:actionfunction>
                                        <apex:actionfunction action="{!putValue}" name="putValueInJavascript" rerender="output1" status="retrieveStatus">
                                            <apex:param name="inputValue" value="">
                                            </apex:param>
                                            <apex:param name="rowId" value="">
                                            </apex:param>
                                            <apex:param name="inputType" value="">
                                            </apex:param>
                                        </apex:actionfunction>
                                        <!-- 定義actionfunction  -->
                                        <!-- 定義一個叫做listIndex的變數 預設值設為 Integer 1 -->
                                        <apex:variable value="{!1}" var="listIndex">
                                        </apex:variable>
                                        <!-- 定義一個for in ==> for (var(item) in value(List) ) {...} -->
                                        <apex:repeat value="{!participantList}" var="item">
                                            <tr>
                                                <td data-th="刪除">
                                                    <input class="pure-button pure-button-primary pure-u-1-1" onclick="delRowInJavascript('{!listIndex}')" type="button" value="删除"/>
                                                </td>
                                                <td data-th="序號">
                                                    {!listIndex}
                                                </td>
                                                <td data-th="工號">
                                                    <input onchange="putValueInJavascript(this.value,{!listIndex},'empid')" type="text" value="{!item.empid}"/>
                                                </td>
                                                <td data-th="姓名">
                                                    <input id="participant_{!listIndex}" onchange="putValueInJavascript(this.value,{!listIndex},'name')" readonly="readonly" type="text" value="{!item.name}"/>
                                                </td>
                                                <td data-th="工作指派描述">
                                                    <input id="participant_{!listIndex}" onchange="putValueInJavascript(this.value,{!listIndex},'taskNote')" style="width: 100%" type="text" value="{!item.taskNote}"/>
                                                </td>
                                            </tr>
                                            <apex:variable value="{!listIndex+1}" var="listIndex">
                                            </apex:variable>
                                        </apex:repeat>
                                    </tbody>
                                </table>
                            </apex:outputpanel>
                        </fieldset>
                    </apex:form>
                </apex:pageblock>
            </div>
        </div>
    </html>
</apex:page>